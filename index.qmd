---
title: "Iranian Diaspora Dashboard"

format:
  html:
    page-layout: full
    grid:
      sidebar-width: 0px
      margin-width: 0px
      body-width: 1500px
execute:
  echo: false
knitr:
  opts_chunk:
    fig.width: 7
    fig.height: 5
    fig.align: "center"
---

<style>
/* Import Montserrat Font */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');

/* Global Font Styling */
html, body {
  font-family: "Montserrat", serif;
  margin: 0;
  padding: 0;
}

/* Header Container */
.header-container {
  background-color: #2774AE;
  width: 100%;
  box-sizing: border-box;
  position: relative;
}

/* Compact Header with Combined Navigation */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 20px;
  height: 50px;
  background-color: #2774AE;
  width: 100%;
  box-sizing: border-box;
}

/* Title Styling */
.header-title {
  color: white;
  font-size: 20px;
  font-weight: bold;
  text-decoration: none;
  white-space: nowrap;
}

/* Navigation Bar */
.navbar {
  border: none;
  box-shadow: none;
  margin: 0;
  padding: 0;
}

/* Tab Button Reset - Complete border removal */
.navbar .tab-button {
  border: none !important;
  background-color: #2774AE;
  color: white;
  padding: 6px 10px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin: 0;
  border-radius: 0;
  outline: none !important;
  box-shadow: none !important;
  position: relative; /* For pseudo-element positioning */
}

/* Active Tab - Using pseudo-element for underline */
.navbar .tab-button.active {
  background-color: #4a8bc9;
  font-weight: bold;
  position: relative;
}

/* Create bottom border with pseudo-element instead */
.navbar .tab-button.active::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background-color: white;
}

/* Hover Effect */
.navbar .tab-button:hover {
  background-color: #5fa4e0;
  color: white;
}

/* Footer Styling */
.footer {
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #2774AE;
  color: white;
  padding: 5px 20px;
  width: 100%;
  height: 50px;
  box-sizing: border-box;
  border: none;
}

/* Footer Logo Container */
.footer-left {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
}

/* Footer Logo */
.footer-logo {
  max-height: 40px;
  height: auto;
}

/* Footer Text */
.footer-text {
  color: white;
  font-size: 14px;
}

/* Footer Links */
.footer-links {
  display: flex;
  gap: 15px;
}

/* Footer Link Styles */
.footer-link {
  color: white;
  text-decoration: none;
  font-size: 14px;
  transition: all 0.3s ease;
}

.footer-link:hover {
  color: #e0e0e0;
  text-decoration: underline;
}

/* Dropdown Menu */
.dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background-color: white;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
  border-radius: 5px;
  z-index: 1000;
  width: 200px;
}

/* Show Dropdown on Hover */
.tab-button:hover .dropdown-menu {
  display: block;
}

/* Tab Content */
.tab-content {
  display: none;
  background-color: #FAFAFA !important;
  padding: 15px 40px 40px 40px;
  text-align: center;
  font-size: 20px;
  color: #333;
  margin-top: 0;
}

/* Show Active Tab */
.tab-content.active {
  display: block;
}

/* Submenu */
.submenu {
  position: absolute;
  width: 100%;
  background-color: #2774AE;
  padding: 1px 10px; /* Reduced vertical padding further */
  z-index: 100;
  text-align: center;
  visibility: visible;
  opacity: 1;
  transition: opacity 0.3s ease-in-out;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  box-sizing: border-box;
}

/* Submenu Wrapper */
.submenu-wrapper {
  max-width: 100%;
  margin: 0 auto;
  display: flex;
  justify-content: center;
}

/* Sub-Tabs */
.sub-tab {
  border: none !important;
  background-color: #2774AE;
  color: white;
  padding: 3px 10px;
  font-size: 12px;
  cursor: pointer;
  margin: 0;
  outline: none !important;
  box-shadow: none !important;
  position: relative;
  line-height: 1.2;
}

.sub-tab.active {
  background-color: #4a8bc9;
  font-weight: bold;
  position: relative;
}

.sub-tab.active::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background-color: white;
}

/* Hover Sub-Tab */
.sub-tab:hover {
  background-color: #5fa4e0;
  color: white;
}

/* Responsive Styling */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    height: auto;
    padding: 5px;
  }

  .navbar {
    margin-top: 5px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .header-title {
    margin-bottom: 5px;
  }

  .footer {
    flex-direction: column;
    height: auto;
    padding: 10px 20px;
  }

  .footer-links {
    margin-top: 10px;
  }
}

#about.tab-content {
  font-size: 1em;
}
</style>


```{=html}
<!-- Header Container -->
<div class="header-container">
  <!-- Combined Header with Title and Navigation -->
  <div class="header">
    <a href="/" class="header-title">Iranian Diaspora Dashboard</a>
    
    <!-- Main Navigation Bar -->
    <nav class="navbar">
      <button class="tab-button" onclick="showTab('global', this)">Global</button>
      <button class="tab-button" onclick="showTab('united-states', this)">United States</button>
      <button class="tab-button" onclick="showTab('canada', this)">Canada</button>
      <button class="tab-button" onclick="showTab('europe', this)">Europe</button>
      <button class="tab-button" onclick="showTab('bibliography', this)">Bibliography</button>
      <button class="tab-button" onclick="showTab('about', this)">About</button>
    </nav>
  </div>

  <!-- United States Submenu - Now with matching width -->
<div id="united-states-submenu" class="submenu" style="display: none;">
  <div class="submenu-wrapper">
    <button class="tab-button sub-tab" data-tab="population" onclick="showSubTab('population', this)">Defining the Population</button>
    <button class="tab-button sub-tab" data-tab="immigration" onclick="showSubTab('immigration', this)">Immigration & Citizenship</button>
    <button class="tab-button sub-tab" data-tab="marriage" onclick="showSubTab('marriage', this)">Marriage</button>
    <button class="tab-button sub-tab" data-tab="education" onclick="showSubTab('education', this)">Education</button>
    <button class="tab-button sub-tab" data-tab="work" onclick="showSubTab('work', this)">Work</button>
  </div>
</div>

<!-- Tab Content Below Header -->
<div id="canada" class="tab-content">
  <h2>Coming Soon</h2>
  <p>This section is under construction. Stay tuned!</p>
</div>

<!-- Europe Content -->
<div id="europe" class="tab-content">
    <h2>Coming Soon</h2>
    <p>This section is under construction. Stay tuned!</p>
</div>


</div>
```

<!-- Global (loads immediately as default tab) -->
<div id="global" class="tab-content">
  <iframe 
    src="https://idd-ucla.shinyapps.io/page_6_grid_app/"
    width="100%" 
    style="border: none; height: 850px;"
    id="global-iframe">
  </iframe>
</div>

<!-- Population (lazy loaded) -->
<div id="population" class="tab-content"> 
  <iframe 
    data-src="https://idd-ucla.shinyapps.io/page_1_grid_app/"
    width="100%" 
    style="border: none; height: 850px;"
    id="population-iframe">
  </iframe>
</div>

<!-- Immigration (lazy loaded) -->
<div id="immigration" class="tab-content">
  <iframe 
    data-src="https://idd-ucla.shinyapps.io/page_2_grid_app/"
    width="100%" 
    style="border: none; height: 850px;"
    id="immigration-iframe">
  </iframe>
</div>

<!-- Marriage (lazy loaded) -->
<div id="marriage" class="tab-content">
  <iframe 
    data-src="https://idd-ucla.shinyapps.io/page_3_grid_app"
    width="100%" 
    style="border: none; height: 850px;"
    id="marriage-iframe">
  </iframe>
</div>

<!-- Education (lazy loaded) -->
<div id="education" class="tab-content">
  <iframe 
    data-src="https://idd-ucla.shinyapps.io/page_4_grid_app/"
    width="100%" 
    style="border: none; height: 850px;"
    id="education-iframe">
  </iframe>
</div>

<!-- Work (lazy loaded) -->
<div id="work" class="tab-content">
  <iframe 
    data-src="https://idd-ucla.shinyapps.io/page_5_grid_app/"
    width="100%" 
    style="border: none; height: 850px;"
    id="work-iframe">
  </iframe>
</div>

<!-- Bibliography (lazy loaded) -->
<div id="bibliography" class="tab-content">
  <span style="text-align: center; display: block; font-size: 20px;">
    An International Bibliography of the Iranian Diaspora<br>
    Compiled by H.E. Chehabi and Amir Sayadabdi
  </span>
  <div style="width: 100%; height: 600px;">
    <iframe 
      data-src="https://idd-ucla.shinyapps.io/idd_bib/"
      width="100%" 
      height="600" 
      style="border: none;"
      id="bibliography-iframe">
    </iframe>
  </div>
</div>

<!-- Updated JavaScript with lazy loading -->
<script>
// Track which iframes have been loaded
let loadedIframes = new Set(['global']); // Global is loaded by default

document.addEventListener("DOMContentLoaded", function () {
    // Default: Activate the Global main tab
    let globalTab = document.querySelector(".tab-button:first-child");
    if (globalTab) {
        globalTab.classList.add("active");
    }
    // Default: Show "Global" tab content
    let globalContent = document.getElementById("global");
    if (globalContent) {
        globalContent.classList.add("active");
        globalContent.style.display = "block";
    }

    // Hide all submenus by default
    document.querySelectorAll('.submenu').forEach(menu => {
        menu.style.display = "none";
    });
});

function loadIframe(tabName) {
    // Skip if already loaded
    if (loadedIframes.has(tabName)) return;
    
    // Find the iframe
    let iframe = document.querySelector(`#${tabName} iframe, #${tabName} div iframe`);
    if (iframe && iframe.dataset.src) {
        // Show loading message
        iframe.style.opacity = '0.5';
        iframe.parentElement.style.position = 'relative';
        
        // Create loading indicator
        let loader = document.createElement('div');
        loader.innerHTML = 'Loading...';
        loader.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #2774AE;
            z-index: 10;
        `;
        iframe.parentElement.appendChild(loader);
        
        // Load the iframe
        iframe.src = iframe.dataset.src;
        delete iframe.dataset.src;
        
        // Remove loader when iframe loads
        iframe.onload = function() {
            iframe.style.opacity = '1';
            if (loader.parentElement) {
                loader.remove();
            }
        };
        
        // Mark as loaded
        loadedIframes.add(tabName);
    }
}

function showTab(tabName, element) {
    // Existing tab switching code...
    document.querySelectorAll('.tab-button:not(.sub-tab)').forEach(button => {
        button.classList.remove("active");
    });

    if (element) {
        element.classList.add("active");
    }

    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove("active");
        tab.style.display = 'none';
    });

    let selectedTab = document.getElementById(tabName);
    if (selectedTab) {
        selectedTab.classList.add("active");
        selectedTab.style.display = "block";
        
        // Load iframe if not already loaded
        loadIframe(tabName);
    }

    document.querySelectorAll('.submenu').forEach(menu => {
        menu.style.display = "none";
    });

    let unitedStatesSubmenu = document.getElementById("united-states-submenu");
    if (tabName === "united-states") {
        unitedStatesSubmenu.style.display = "block";
        
        let definingPopulationTab = document.querySelector(".sub-tab[data-tab='population']");
        if (definingPopulationTab) {
            definingPopulationTab.classList.add("active");
            showSubTab("population", definingPopulationTab);
        }
    } else {
        document.querySelectorAll(".sub-tab").forEach(subtab => {
            subtab.classList.remove("active");
        });
    }
}

function showSubTab(subTabId, element) {
    document.querySelectorAll(".sub-tab").forEach(tab => {
        tab.classList.remove("active");
    });

    if (element) {
        element.classList.add("active");
    }

    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove("active");
        tab.style.display = 'none';
    });

    let subTabContent = document.getElementById(subTabId);
    if (subTabContent) {
        subTabContent.classList.add("active");
        subTabContent.style.display = "block";
        
        // Load iframe if not already loaded
        loadIframe(subTabId);
    }
}
</script>